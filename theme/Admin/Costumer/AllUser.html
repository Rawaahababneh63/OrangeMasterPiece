<!DOCTYPE html>
<html>
  <head>
    <!-- Basic Page Info -->
    <meta charset="utf-8" />
    <title>DeskApp - Bootstrap Admin Dashboard HTML Template</title>

    <!-- Site favicon -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="../vendors/images/apple-touch-icon.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="../vendors/images/favicon-32x32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="../vendors/images/favicon-16x16.png"
    />

    <!-- Mobile Specific Metas -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />

    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../vendors/styles/core.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="../vendors/styles/icon-font.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="../src/plugins/datatables/css/dataTables.bootstrap4.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="../src/plugins/datatables/css/responsive.bootstrap4.min.css"
    />
    <link rel="stylesheet" type="text/css" href="../vendors/styles/style.css" />

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-GBZ3SGGX85"
    ></script>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2973766580778258"
      crossorigin="anonymous"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-GBZ3SGGX85");
    </script>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-NXZMQSS");
    </script>
    <!-- End Google Tag Manager -->
  </head>
  <style>
    .section {
            display: none;
        }
        .section.active {
    display: block;
    margin-top: 10%;
}
</style>
<body>
	<div class="header">
		<div class="header-left">
			<div class="menu-icon bi bi-list"></div>
			<div class="search-toggle-icon bi bi-search" data-toggle="header_search"></div>
		
		</div>
		<div class="header-right">
			<div class="dashboard-setting user-notification">
				<div class="dropdown">
					<a class="dropdown-toggle no-arrow" href="javascript:;" data-toggle="right-sidebar">
					
					</a>
				</div>
			</div>
	
			<div class="user-info-dropdown">
				<div class="dropdown">
					<a class="dropdown-toggle" href="#" role="button" data-toggle="dropdown">
						
						<span class="user-name">Rawa'ah Ababneh</span>
					</a>
					<div class="dropdown-menu dropdown-menu-right dropdown-menu-icon-list">
					
						<a class="dropdown-item" onclick="logout()"><i class="dw dw-logout"></i> Log Out</a>
					</div>
				</div>
			</div>

		</div>
	</div>
	<div class="left-side-bar">
		<div class="brand-logo">
			<a href="../index1.html">
				<img src="../vendors/images/Smart1.png" alt="" class="dark-logo" />
				<img src="../vendors/images/Smart.png"  class="light-logo" />
			</a>
			
			<div class="close-sidebar" data-toggle="left-sidebar-close">
				<i class="ion-close-round"></i>
			</div>
		</div>
		<div class="menu-block customscroll">
			<div class="sidebar-menu">
				<ul id="accordion-menu">
					<li class="dropdown">
						<a href="../index1.html" class="dropdown-toggle  no-arrow">
							<span class="micon bi bi-house"></span><span class="mtext">Home</span>
						</a>
					</li>
						
				
					
					<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon bi bi-file-earmark-text"></span><span class="mtext">Category
								</span>
						</a>
						<ul class="submenu">
							<li><a href="../Category/AllCategory.html">ALL Category</a></li>
						
							
							
						</ul>
					</li>

					<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon bi bi-file-earmark-text"></span><span class="mtext">SubCategory
								</span>
						</a>
						<ul class="submenu">
							<li><a href="../SubCategory/SubCategory.html">SubCategory By CategoryId</a></li>
							<li><a href="../SubCategory/AllSubCategory.html">ALL SubCategory</a></li>
						
							
							
						</ul>
					</li>

                    <li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
							<span class="micon bi bi-file-earmark-text"></span><span class="mtext">Product
								</span>
						</a>
						<ul class="submenu">
							<li><a href="../Product/allProduct.html">ALLproduct</a></li>
							<li><a href="../Product/addProduct.html">Add product</a></li>
							<li><a href="../Product/applayDisount.html">Applay Discount</a></li>
						</ul>

					</li>


					<li>
						<a href="javascript:;" class="dropdown-toggle">
						  <span class="micon bi bi-file-earmark-text"></span
						  ><span class="mtext">Review </span>
						</a>
						<ul class="submenu">
						  <li><a href="../Product/ReviewUpdat.html">Follow up width review</a></li>
						</ul>
					</li>
					<li class="dropdown">
                        <a href="javascript:;" class="dropdown-toggle">
                          <span class="micon bi bi-file-earmark-text"></span
                          ><span class="mtext">Voucher </span>
                        </a>
						<ul class="submenu">
							<li><a href="../VoucherRawaah/Voucher.html">ALL Voucher</a></li>
						  </ul>
                    </li>
					<li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
						  <span class="micon bi bi-file-earmark-text"></span
						  ><span class="mtext">Orders </span>
						</a>
						<ul class="submenu">
							<li><a href="../Order/AllOrder.html">ALL Order</a></li>
							<li><a href="../Order/GetOrder.html">Search By Email</a></li>
						</ul>
					</li>
				    <li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
						  <span class="micon bi bi-file-earmark-text"></span
						  ><span class="mtext">Contact </span>
						</a>
						<ul class="submenu">
						  <li><a href="../Contact/Contact Us.html">ALL Contact</a></li>
						
						</ul>
					  </li>
					  <li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
						  <span class="micon bi bi-file-earmark-text"></span
						  ><span class="mtext">RequestSell</span>
						</a>
						<ul class="submenu">
							<li><a href="../RequestSell/RequestSell.html">RequestSell</a></li>
						
						</ul>
					  </li>
                      <li class="dropdown">
						<a href="javascript:;" class="dropdown-toggle">
						  <span class="micon bi bi-file-earmark-text"></span
						  ><span class="mtext">Costumers</span>
						</a>
						<ul class="submenu">
							<li><a href="../Costumer/AllUser.html">AllUser</a></li>
					

						</ul>
					  </li>
				
				</ul>
			</div>
		</div>
	</div>
	<div class="mobile-menu-overlay"></div>
    

             <!-- Container fluid -->
             <div class="app-content-area">
                <section id="productSection" class="section active">
    <div class="container mt-5">
        <h2>Manage Users</h2>
        <!-- <input type="search" class="form-control mt-2" placeholder="Search Users..." id="searchUser" oninput="filterUsers()"> -->
        <table class="table table-striped mt-3">
            <thead>
                <tr>
                    <th>Customer</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Location</th>
               
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="userTable">
                <!-- User data will be loaded here -->
            </tbody>
        </table>

    
    </div>
                </section>
            </div>
           </div>
  

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteUserModal" tabindex="-1" aria-labelledby="deleteUserModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteUserModalLabel">Delete User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this user?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDelete" onclick="deleteUser()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let users = [];  // Global users array
        let userIdToDelete = null;
        let userIdToEdit = null;

        // Fetch and display users
        async function loadUsers() {
            const url = "https://localhost:44332/api/Users/GetALLUsersaa";
            let response = await fetch(url);
            users = await response.json();
            displayUsers(users);
        }

        // Display users in the table
        function displayUsers(users) {
            let userTable = document.getElementById('userTable');
            userTable.innerHTML = '';
            users.forEach(user => {
                userTable.innerHTML += `
                <tr>
                    <td>${user.userName}</td>
                    <td>${user.phoneNumber}</td>
                    <td>${user.email}</td>
                    <td>${user.address}</td>
                
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="Details(${user.userId})">Detalis</button>
                        <button class="btn btn-sm btn-danger" onclick="openDeleteModal(${user.userId})">Delete</button>
                    </td>
                </tr>`;
            });
        }

        // Open delete confirmation modal
        function openDeleteModal(id) {
            userIdToDelete = id;
            var deleteModal = new bootstrap.Modal(document.getElementById('deleteUserModal'));
            deleteModal.show();
        }

        // Open edit modal and populate data
        function openEditModal(id) {
            userIdToEdit = id;  // تعيين قيمة userIdToEdit هنا
            let user = users.find(user => user.userId === id);
            document.getElementById('Name').value = user.name;
            document.getElementById('PhoneNumber').value = user.phoneNumber;
            document.getElementById('Email').value = user.email;
            var editModal = new bootstrap.Modal(document.getElementById('editUserModal'));
            editModal.show();
        }

        // Delete user
        async function deleteUser() {
            const urlDelete = `https://localhost:44367/api/AdminControllers/User?id=${userIdToDelete}`;
            let response = await fetch(urlDelete, {
                method: "DELETE"
            });
            if (response.ok) {
                alert("User deleted successfully");
                loadUsers();  // Refresh the user list after deletion
            } else {
                alert("Failed to delete user");
            }
        }

        // Save user changes
        async function saveUserChanges() {
          debugger;
            const urlEdit = `https://localhost:44367/api/AdminControllers/User?id=${userIdToEdit}`;
            let formData = new FormData(document.getElementById('editUserForm'));

            let response = await fetch(urlEdit, {
                method: "PUT",
                body: formData
            });

            if (response.ok) {
                alert("User updated successfully");
                loadUsers();  // Refresh the user list after editing
                var editModalEl = document.getElementById('editUserModal');
                var modal = bootstrap.Modal.getInstance(editModalEl);
                modal.hide();
            } else {
                alert("Failed to update user");
            }
        }
        function Details(id) {
   
    localStorage.setItem('userId', id);
    window.location.href="UserAllInfomation.html";
}

        // Load users on page load
        loadUsers();
    </script>
  <script>

    function logout() {
        localStorage.removeItem("jwtToken");
        localStorage.removeItem("UserId");
        window.location.href = "../../index_2.html";
        }
    </script>
  <!-- js -->
  <script src="../vendors/scripts/core.js"></script>
  <script src="../vendors/scripts/script.min.js"></script>
  <script src="../vendors/scripts/process.js"></script>
  <script src="../vendors/scripts/layout-settings.js"></script>
  <script src="../src/plugins/apexcharts/apexcharts.min.js"></script>
  <script src="../src/plugins/datatables/js/jquery.dataTables.min.js"></script>
  <script src="../src/plugins/datatables/js/dataTables.bootstrap4.min.js"></script>
  <script src="../src/plugins/datatables/js/dataTables.responsive.min.js"></script>
  <script src="../src/plugins/datatables/js/responsive.bootstrap4.min.js"></script>
  <script src="../vendors/scripts/dashboard.js"></script>
  <script src="AllOrder.js"></script>
</body>
</html>
