<!doctype html>
<html class="no-js" lang="zxx">

<!-- Mirrored from preview.colorlib.com/theme/capitalshop/cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 04:32:23 GMT -->
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Shop | eCommers</title>
<meta name="description" content>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" type="image/x-icon" href="assets/img/icon/favicon.png">

<link rel="stylesheet" href="assets/css/bootstrap.min.css">
<link rel="stylesheet" href="assets/css/owl.carousel.min.css">
<link rel="stylesheet" href="assets/css/slicknav.css">
<link rel="stylesheet" href="assets/css/flaticon.css">
<link rel="stylesheet" href="assets/css/animate.min.css">
<link rel="stylesheet" href="assets/css/price_rangs.css">
<link rel="stylesheet" href="assets/css/magnific-popup.css">
<link rel="stylesheet" href="assets/css/fontawesome-all.min.css">
<link rel="stylesheet" href="assets/css/themify-icons.css">
<link rel="stylesheet" href="assets/css/slick.css">
<link rel="stylesheet" href="assets/css/nice-select.css">
<link rel="stylesheet" href="assets/css/style.css">
<link rel="stylesheet" href="assets/css/style1.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>

<div id="preloader-active">
<div class="preloader d-flex align-items-center justify-content-center">
<div class="preloader-inner position-relative">
<div class="preloader-circle"></div>
<div class="preloader-img pere-text">
<img src="assets/img/icon/loder.png" alt="loder">
</div>
</div>
</div>
</div>

<header>
    <div class="header-area">
        <!-- الجزء الأول (Header-Top) -->
        <div class="header-top d-none d-sm-block">
            <div class="container">
                <div class="row">
                    <div class="col-xl-12">
                        <div class="d-flex justify-content-between flex-wrap align-items-center">
                            <div class="header-info-left">
                                <ul>
                                   
                                    <!-- <li><a href="#">الخصوصية</a></li> -->
                                    <li><a href="CleanOut.html#faq">الأسئلة الشائعة</a></li>
                                    <li><a href="About1.html">معلومات عنا</a></li>
                                </ul>
                            </div>
                            <div class="header-info-right d-flex">
                                <ul class="order-list">
                                    <li><a href="#">قائمة أمنياتي</a></li>
                                    <li><a href="checkout.html">تتبع الطلب</a></li>
                                </ul>
                                <ul class="header-social">
                                    <li><a href="#"><i class="fab fa-facebook"></i></a></li>
                                    <li><a href="#"><i class="fab fa-instagram"></i></a></li>
                                    <li><a href="#"><i class="fab fa-twitter"></i></a></li>
                                    <li><a href="#"><i class="fab fa-linkedin-in"></i></a></li>
                                    <li><a href="#"><i class="fab fa-youtube"></i></a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    
        <!-- الجزء الثاني (Header-Bottom) -->
        <div class="header-bottom text-center">
            <p dir="rtl" >تخفيضات تصل إلى 50%  أسرع ! العرض لفترة محدودة <a href="categories.html" class="browse-btn" >تسوق الآن</a></p>
        </div>
    
  
          
        </div>
    </div>
    </header>
    
<main>

<div class="hero-area section-bg2">
<div class="container">
<div class="row">
<div class="col-xl-12">
<div class="slider-area">
<div class="slider-height2 slider-bg4 d-flex align-items-center justify-content-center">
<div class="hero-caption hero-caption2">
<h2>عربة التسوق</h2>
<nav aria-label="breadcrumb">
<ol class="breadcrumb justify-content-center">
    <li class="breadcrumb-item"><a href="#">عربة التسوق</a></li>
<li class="breadcrumb-item"><a href="index.html">الرئيسية</a></li>

</ol>
</nav>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="shopping_cart_area mt-100">
    <div class="container">
      <form action="#">
        <div class="row">
          <div class="col-12">
            <div class="table_desc">
              <div class="cart_page table-responsive">
                <table>
                  <thead>
                    <tr>
                      <th class="product_remove">Delete</th>
                      <th class="product_thumb">Image</th>
                      <th class="product_name">Product</th>
                      <th class="product-price">Price</th>
                      <th class="product_quantity">Quantity</th>
                      <th class="product_total">Total</th>
                    </tr>
                  </thead>
                  <tbody id="table"></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <!-- coupon code area start -->
        <div class="coupon_area">
          <div class="row">
            <div class="col-lg-6 col-md-6">
              <div class="coupon_code left">
                <h3>Coupon</h3>
                <div class="coupon_inner">
                  <p>Enter your Voucher code if you have one.</p>
                  <input id="inputVoucher" placeholder="Coupon code" type="text" />
                  <button type="button" onclick="checkVoucher()">Apply coupon</button>
                  <p id="errorMessage" class="text-danger"></p>
                </div>
              </div>
            </div>
            <div class="col-lg-6 col-md-6">
              <div class="coupon_code right">
                <h3>Cart Totals</h3>
                <div class="coupon_inner">
                  <div class="cart_subtotal">
                    <p>Subtotal</p>
                    <p class="cart_amount" id="totalCartPrice">$0.00</p>
                  </div>
                  <div class="cart_subtotal">
                    <p>Discount</p>
                    <p id="disconteAmount" class="cart_amount">$0.00</p>
                  </div>
                  <hr />
                  <div class="cart_subtotal">
                    <p>Total</p>
                    <p id="totalAfterDisconte" class="cart_amount">$0.00</p>
                  </div>
                  <div class="checkout_btn">
                    <button type="submit" onclick="checkOut()">Proceed to Checkout</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- coupon code area end -->
      </form>
    </div>
  </div>
 
</main>
<footer>
    <div class="footer-wrapper gray-bg">
        <div class="footer-area footer-padding">

            <!-- قسم الاشتراك في النشرة الإخبارية -->
            <section class="subscribe-area">
                <div class="container">
                    <div class="row justify-content-between subscribe-padding">
                        <div class="col-xxl-2 col-xl-2 col-lg-4">
                            <div class="footer-social">
                                <a href="https://bit.ly/sai4ull"><i class="fab fa-facebook"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                                <a href="#"><i class="fab fa-youtube"></i></a>
                            </div>
                        </div>
                       
                        <div class="col-xxl-5 col-xl-6 col-lg-7 col-md-9">
                            <div class="subscribe-caption">
                                <form action="#">
                                    <input type="text" placeholder="أدخل بريدك الإلكتروني">
                                    <button class="subscribe-btn">اشترك</button>
                                </form>
                            </div>
                        </div>
                        <div class="col-xxl-3 col-xl-3 col-lg-4">
                            <div class="subscribe-caption">
                                <h3>اشترك في النشرة الإخبارية</h3>
                                <p>اشترك في النشرة الإخبارية للحصول على خصم 5% على جميع المنتجات.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- قسم معلومات الفوتر -->
            <div class="container">
                <div class="row justify-content-between">
                  
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>تسوق للرجال</h4>
                                <ul>
                                    <li><a href="#">أزياء الملابس</a></li>
                                    <li><a href="#">شتاء</a></li>
                                    <li><a href="#">صيف</a></li>
                                    <li><a href="#">رسمية</a></li>
                                    <li><a href="#">عادية</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle" >
                                <h4>تسوق للنساء</h4>
                                <ul>
                                    <li><a href="#">أزياء الملابس</a></li>
                                    <li><a href="#">شتاء</a></li>
                                    <li><a href="#">صيف</a></li>
                                    <li><a href="#">رسمية</a></li>
                                    <li><a href="#">عادية</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-2 col-lg-2 col-md-4 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="footer-tittle">
                                <h4>معلومات</h4>
                                <ul>
                                    <li><a href="#">من نحن</a></li>
                                    <li><a href="#">سياسة الخصوصية</a></li>
                                    <li><a href="#">الشروط والأحكام</a></li>
                                    <li><a href="#">اتصل بنا</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-6 col-sm-8">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-20">
                                <div class="footer-logo mb-35">
                                    <a href="index.html"><img src="assets/img/logo/logo2_footer.png" alt="شعار"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
  
</footer>

<div id="back-top">
<a class="wrapper" title="Go to Top" href="#">
<div class="arrows-container">
<div class="arrow arrow-one">
</div>
<div class="arrow arrow-two">
</div>
</div>
</a>
</div>


<script src="assets/js/vendor/modernizr-3.5.0.min.js"></script>
<script src="assets/js/vendor/jquery-1.12.4.min.js"></script>
<script src="assets/js/popper.min.js"></script>
<script src="assets/js/bootstrap.min.js"></script>

<script src="assets/js/owl.carousel.min.js"></script>
<script src="assets/js/slick.min.js"></script>
<script src="assets/js/jquery.slicknav.min.js"></script>

<script src="assets/js/wow.min.js"></script>
<script src="assets/js/jquery.magnific-popup.js"></script>
<script src="assets/js/jquery.nice-select.min.js"></script>
<script src="assets/js/jquery.counterup.min.js"></script>
<script src="assets/js/waypoints.min.js"></script>
<script src="assets/js/price_rangs.js"></script>

<script src="assets/js/contact.js"></script>
<script src="assets/js/jquery.form.js"></script>
<script src="assets/js/jquery.validate.min.js"></script>
<script src="assets/js/mail-script.js"></script>
<script src="assets/js/jquery.ajaxchimp.min.js"></script>

<script src="assets/js/plugins.js"></script>
<script src="assets/js/main.js"></script>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-23581568-13"></script>
<script>
 
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-23581568-13');
</script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"8c3e21530c8a32ae","version":"2024.8.0","serverTiming":{"name":{"cfExtPri":true,"cfL4":true}},"token":"cd0b4b3a733644fc843ef0b185f98241","b":1}' crossorigin="anonymous"></script>
<script>
/** @format */
// var token = localStorage.getItem("Token");
  var userId = localStorage.getItem("UserId");
  var totalCartPrice = 0;
  var disconteAmount = 0;

  var errorMessage = document.getElementById("errorMessage");


  async function checkVoucher() {
  if (userId == null) {
    alert("يجب عليك تسجيل الدخول قبل استخدام القسيمة!");
  } else {
    var voucher = document.getElementById("inputVoucher").value;

    const url = `https://localhost:44332/api/Cart/ApplyVoucher/${voucher}`;

    try {
      var response = await fetch(url);
      var data = await response.json();

      if (!response.ok) {
        errorMessage.innerHTML = data.message;
      } else {
        disconteAmount = parseFloat(data.discount);

        var discount = (disconteAmount / 100) * totalCartPrice;
        var totalAfterDisconte = totalCartPrice - discount;

        var disconteAmountText = document.getElementById("disconteAmount");
        disconteAmountText.textContent = `$${discount.toFixed(2)}`;

        var totalAfterDisconteText =
          document.getElementById("totalAfterDisconte");
        totalAfterDisconteText.innerHTML = `$${totalAfterDisconte.toFixed(2)}`;

        localStorage.amountForPay = totalAfterDisconte.toFixed(2);

        errorMessage.innerHTML = "";

        alert("تم تطبيق القسيمة بنجاح!");
      }
    } catch (error) {
      console.error("حدث خطأ أثناء تطبيق القسيمة.", error);
      errorMessage.innerHTML = "An error occurred while applying the voucher.";
    }
  }
}

disconteAmountText = document.getElementById("disconteAmount");
disconteAmountText.textContent = `$${disconteAmount.toFixed(2)}`;



////////////هاد كود القسيمة

//   async function checkVoucher() {
//     if (userId == null) {
//       alert("You must be logged in before using a voucher!");
//     } else {
//       var voucher = document.getElementById("inputVoucher").value;
//       const url = `https://localhost:44362/api/Cart/ApplyVoucher/${voucher}`;

//       try {
//         var response = await fetch(url);
//         var data = await response.json();

//         if (!response.ok) {
//           errorMessage.innerHTML = data.message;
//         } else {
//           disconteAmount = parseFloat(data.discount);
//           var discount = (disconteAmount / 100) * totalCartPrice;
//           var totalAfterDisconte = totalCartPrice - discount;

//           document.getElementById("disconteAmount").textContent = `$${discount.toFixed(2)}`;
//           document.getElementById("totalAfterDisconte").innerHTML = `$${totalAfterDisconte.toFixed(2)}`;

//           localStorage.amountForPay = totalAfterDisconte.toFixed(2);
//           errorMessage.innerHTML = "";
//           alert("Voucher applied successfully!");
//         }
//       } catch (error) {
//         console.error("Error applying voucher:", error);
//         errorMessage.innerHTML = "An error occurred while applying the voucher.";
//       }_i
//     }
//   }







// async function showItemsCart() {
//   if (userId == null) {
//     debugger
//     var selectedItems = JSON.parse(localStorage.getItem("cartItems"));

//     let itemContainer = document.getElementById("table");

//     selectedItems.forEach((item) => {
//       totalCartPrice += item.price * item.quantity;

//       itemContainer.innerHTML += `
//     <tr id="item-row-${item.product_id}">
//       <td class="product_remove" style="cursor: pointer;">
//         <i onclick="deleteItem1(${item.product_id})" class="fa fa-trash-o"></i>
//       </td>
//       <td class="product_thumb">
//          <a href="#"><img src="../../../../Backend/Masterpiece/Masterpiece/Uploads/${
//            item.image
//          }" alt=""></a>
//       </td>
//       <td class="product_name">
//         <a href="#">${item.name}</a>
//       </td>
//       <td class="product-price">$${item.price}</td>
//       <td class="product_quantity">
//         <label>Quantity</label>
//         <input id="quantity-${item.product_id}" min="1" max="100"
//                value="${item.quantity}" type="number"
//                onchange="changeQuantity1(${item.product_id}, ${item.price})">
//       </td>
//       <td id="total-price-${item.product_id}" class="product_total">
//         $${(item.price * item.quantity).toFixed(2)}
//       </td>
//     </tr>
//   `;
//     });

//     updateTotalCartPrice();
//   } else {debugger
//     let url2 = `https://localhost:44332/api/Cart/getUserCartItems/${userId}`;

//     let request = await fetch(`https://localhost:44332/api/Cart/getUserCartItems/${userId}`);
//     let result = await request.json();
//     let itemContainer = document.getElementById("table");

//     result.forEach((item) => {
//       totalCartPrice += item.product.priceWithDiscount * item.quantity;

//       itemContainer.innerHTML += `
//     <tr id="item-row-${item.cartItemId}">
//       <td class="product_remove" style="cursor: pointer;">
//         <i onclick="deleteItem(${item.cartItemId})" class="fa fa-trash-o"></i>
//       </td>
//       <td class="product_thumb">
//         <a href="#"><img src="../../../../Backend/Masterpiece/Masterpiece/Uploads/${
//           item.product.image
//         }" alt=""></a>
//       </td>
//       <td class="product_name">
//         <a href="#">${item.product.name}</a>
//       </td>
//       <td class="product-price">$${item.product.priceWithDiscount}</td>
//       <td class="product_quantity">
//         <label>Quantity</label>
//         <input id="quantity-${item.cartItemId}" min="1" max="100"
//                onchange="changeQuantity(${item.cartItemId}, ${
//         item.product.priceWithDiscount
//       })"
//                value="${item.quantity}" type="number">
//       </td>
//       <td id="total-price-${item.cartItemId}" class="product_total">
//         $${(item.product.priceWithDiscount * item.quantity).toFixed(2)}
//       </td>
//     </tr>
//   `;
//     });

//     updateTotalCartPrice();
//   }
// }
// showItemsCart();

// // Function to change the quantity of the cart item in local storage
// function changeQuantity1(cartItemId, priceWithDiscount) {
//   const quantityInput = document.getElementById(`quantity-${cartItemId}`);
//   const newQuantity = parseInt(quantityInput.value);

//   let cartItems = JSON.parse(localStorage.getItem("cartItems"));

//   cartItems = cartItems.map((item) => {
//     if (item.product_id == cartItemId) {
//       item.quantity = newQuantity;
//     }
//     return item;
//   });

//   localStorage.setItem("cartItems", JSON.stringify(cartItems));

//   const totalPriceElement = document.getElementById(`total-price-${cartItemId}`);
//   const updatedTotalPrice = (priceWithDiscount * newQuantity).toFixed(2);
//   totalPriceElement.textContent = `$${updatedTotalPrice}`;

//   updateTotalCartPrice(); // Update the total price without reloading the page
// }

// // Function to recalculate and update the total cart price
// function updateTotalCartPrice() {
//   let totalCartPrice = 0;
//   let cartItems = JSON.parse(localStorage.getItem("cartItems"));

//   cartItems.forEach((item) => {
//     totalCartPrice += parseFloat(item.price) * item.quantity;
//   });

//   document.getElementById(
//     "totalCartPrice"
//   ).textContent = `$${totalCartPrice.toFixed(2)}`;

//   let totalAfterDisconte = totalCartPrice - disconteAmount;
//   document.getElementById("totalAfterDisconte").textContent = `$${totalAfterDisconte.toFixed(2)}`;

//   localStorage.amountForPay = totalAfterDisconte.toFixed(2);
// }

// /////////////////////////////////////////////////////////////////////////////////////////////////////////

// function deleteItem1(productId) {
//   let storedCartItems = JSON.parse(localStorage.getItem("cartItems"));

//   const updatedCartItems = storedCartItems.filter(
//     (item) => item.product_id != productId.toString()
//   );

//   localStorage.setItem("cartItems", JSON.stringify(updatedCartItems));

//   const itemRow = document.getElementById(`item-row-${productId}`);
//   if (itemRow) {
//     itemRow.remove(); // Remove the item row without reloading the page
//   }

//   updateTotalCartPrice(); // Update the total price without reloading the page
// }
// //////////////////////////////////////////////////////////////////////////////////////////////////////////////
// async function deleteItem(cartItemId) {
//   let url = `https://localhost:44332/api/Cart/deleteItemById/${cartItemId}`;

//   fetch(url, {
//     method: "DELETE",
//   }).then((response) => {
//     if (response.ok) {
//       const itemRow = document.getElementById(`item-row-${cartItemId}`);
//       if (itemRow) {
//         itemRow.remove(); // Remove the item row without reloading the page
//       }
//       alert("Item was deleted!");
//       updateTotalCartPrice(); // Update the total price without reloading the page
//     }
//   });
// }

// //////////////////////////////////////////////////////////////////////////////////////////////////////////////

// async function changeQuantity(cartItemId, productPrice) {
//   const Quantity = document.getElementById(`quantity-${cartItemId}`);
//   const newQuantity = parseInt(Quantity.value);

//   const url = `https://localhost:44332/api/Cart/changeQuantity`;

//   const response = await fetch(url, {
//     method: "POST",
//     headers: {
//       "Content-Type": "application/json",
//     },
//     body: JSON.stringify({
//       cartItemId: cartItemId,
//       quantity: newQuantity,
//     }),
//   });

//   const newTotalPrice = productPrice * newQuantity;

//   const oldTotalPriceElement = document.getElementById(
//     `total-price-${cartItemId}`
//   );
//   oldTotalPriceElement.innerHTML = `$${newTotalPrice.toFixed(2)}`;

//   updateTotalCartPrice(); // Update the total price without reloading the page
// }

// ///////////////////////////////////////////////////////////////////////////////////////////
// async function checkOut() {

//   localStorage.checkOut = true;
//   const userId = localStorage.getItem("UserId");
//   console.log("UserId from localStorage:", userId); 

//   if (userId && userId !== "null" && userId !== "") { 
//     setTimeout(() => {
//       window.location.href = "/CheckOutrawa.html"; 
//     }, 100); 
//   } else {
//     alert("يجب عليك تسجيل الدخول لإستكمال عملية الشراء");
//     setTimeout(() => {
//       window.location.href = "/capitalshop/login.html"; 
//     }, 100); 
//   }
// }



// ///////////////////////////////////////////////////////////////////////////////////////////
// async function checkOut() {
//   localStorage.checkOut = true;
//   const userId = localStorage.getItem("UserId");
//   console.log("UserId from localStorage:", userId); // لطباعة قيمة userId للتأكد

//   if (userId && userId !== "null" && userId !== "") { 
//     // إذا كانت قيمة userId موجودة وصحيحة
//     setTimeout(() => {
//       window.location.href = "/CheckOutrawa.html"; // تحويل إلى صفحة الجيك أوت
//     }, 100); // تأخير 100 مللي ثانية
//   } else {
//     // إذا كانت قيمة userId غير موجودة أو فارغة
//     alert("يجب عليك تسجيل الدخول لإستكمال عملية الشراء");
//     setTimeout(() => {
//       window.location.href = "/capitalshop/login.html"; // تحويل إلى صفحة تسجيل الدخول
//     }, 100); // تأخير 100 مللي ثانية
//   }
// }



















async function showItemsCart() {
  if (userId == null) {
    debugger
    var selectedItems = JSON.parse(localStorage.getItem("cartItems"));

    let itemContainer = document.getElementById("table");
    totalCartPrice = 0; // إعادة تعيين السعر الكلي إلى 0

    selectedItems.forEach((item) => {
      // حساب السعر النهائي بعد الخصم
      let finalPrice = item.discount ? (item.price - item.discount) : item.price; // إذا كان هناك خصم، احسب السعر بعد الخصم، وإلا احتفظ بالسعر الأصلي
      totalCartPrice += finalPrice * item.quantity;

      itemContainer.innerHTML += `
        <tr id="item-row-${item.product_id}">
          <td class="product_remove" style="cursor: pointer;">
            <i onclick="deleteItem1(${item.product_id})" class="fa fa-trash-o"></i>
          </td>
          <td class="product_thumb">
            <a href="#"><img src="../../../../Backend/Masterpiece/Masterpiece/Uploads/${item.image}" alt=""></a>
          </td>
          <td class="product_name">
            <a href="#">${item.name}</a>
          </td>
          <td class="product-price">$${finalPrice.toFixed(2)}</td>
          <td class="product_quantity">
            <label>Quantity</label>
            <input id="quantity-${item.product_id}" min="1" max="100"
              value="${item.quantity}" type="number"
              onchange="changeQuantity1(${item.product_id}, ${finalPrice})">
          </td>
          <td id="total-price-${item.product_id}" class="product_total">
            $${(finalPrice * item.quantity).toFixed(2)}
          </td>
        </tr>
      `;
    });

    updateTotalCartPrice(); // تحديث السعر الكلي بعد إضافة العناصر
  } else {
    debugger
    let url2 = `https://localhost:44332/api/Cart/getUserCartItems/${userId}`;

    let request = await fetch(url2);
    let result = await request.json();
    let itemContainer = document.getElementById("table");
    totalCartPrice = 0; // إعادة تعيين السعر الكلي إلى 0

    result.forEach((item) => {
      // حساب السعر النهائي بعد الخصم
      let finalPrice = item.product.discount ? (item.product.priceWithDiscount) : (item.product.price); // إذا كان هناك خصم، استخدم السعر بعد الخصم، وإلا احتفظ بالسعر الأصلي
      totalCartPrice += finalPrice * item.quantity;

      itemContainer.innerHTML += `
        <tr id="item-row-${item.cartItemId}">
          <td class="product_remove" style="cursor: pointer;">
            <i onclick="deleteItem(${item.cartItemId})" class="fa fa-trash-o"></i>
          </td>
          <td class="product_thumb">
            <a href="#"><img src="../../../../Backend/Masterpiece/Masterpiece/Uploads/${item.product.image}" alt=""></a>
          </td>
          <td class="product_name">
            <a href="#">${item.product.name}</a>
          </td>
          <td class="product-price">$${finalPrice.toFixed(2)}</td>
          <td class="product_quantity">
            <label>Quantity</label>
            <input id="quantity-${item.cartItemId}" min="1" max="100"
              onchange="changeQuantity(${item.cartItemId}, ${finalPrice})"
              value="${item.quantity}" type="number">
          </td>
          <td id="total-price-${item.cartItemId}" class="product_total">
            $${(finalPrice * item.quantity).toFixed(2)}
          </td>
        </tr>
      `;
    });

    updateTotalCartPrice(); // تحديث السعر الكلي بعد إضافة العناصر
  }
}
showItemsCart();

// Function to change the quantity of the cart item in local storage
function changeQuantity1(cartItemId, priceWithDiscount) {
  const quantityInput = document.getElementById(`quantity-${cartItemId}`);
  const newQuantity = parseInt(quantityInput.value);

  let cartItems = JSON.parse(localStorage.getItem("cartItems"));

  cartItems = cartItems.map((item) => {
    if (item.product_id == cartItemId) {
      item.quantity = newQuantity;
    }
    return item;
  });

  localStorage.setItem("cartItems", JSON.stringify(cartItems));

  const totalPriceElement = document.getElementById(`total-price-${cartItemId}`);
  const updatedTotalPrice = (priceWithDiscount * newQuantity).toFixed(2);
  totalPriceElement.textContent = `$${updatedTotalPrice}`;

  updateTotalCartPrice(); // Update the total price without reloading the page
}

// Function to recalculate and update the total cart price
async function updateCartTotal() {
    // التحقق إذا كان المستخدم مسجل الدخول
    if (userId == null) {
        // المستخدم غير مسجل الدخول - تحديث باستخدام الـ localStorage
        let totalCartPrice = 0;
        var selectedItems = JSON.parse(localStorage.getItem("cartItems"));

        selectedItems.forEach(item => {
            let finalPrice = item.discount ? (item.price - item.discount) : item.price;
            totalCartPrice += finalPrice * item.quantity;
        });

        let cartTotalElements = document.getElementById("totalCartPrice");
        cartTotalElements.innerHTML = `$${totalCartPrice.toFixed(2)}`;

        let disconteAmount = calculateDiscountAmount(); // إذا كان هناك خصم
        let totalAfterDisconte = totalCartPrice - disconteAmount;

        let totalAfterDisconteText = document.getElementById("totalAfterDisconte");
        totalAfterDisconteText.innerHTML = `$${totalAfterDisconte.toFixed(2)}`;

        localStorage.amountForPay = totalAfterDisconte.toFixed(2);
    } else {
        // المستخدم مسجل الدخول - تحديث باستخدام بيانات الـ API
        let url2 = `https://localhost:44332/api/Cart/getUserCartItems/${userId}`;
        let request = await fetch(url2);
        let result = await request.json();

        let totalCartPrice = 0;

        result.forEach(item => {
            let finalPrice = item.product.discount ? item.product.priceWithDiscount : item.product.price;
            totalCartPrice += finalPrice * item.quantity;
        });

        let cartTotalElements = document.getElementById("totalCartPrice");
        cartTotalElements.innerHTML = `$${totalCartPrice.toFixed(2)}`;

        let disconteAmount = calculateDiscountAmount(); // إذا كان هناك خصم
        let totalAfterDisconte = totalCartPrice - disconteAmount;

        let totalAfterDisconteText = document.getElementById("totalAfterDisconte");
        totalAfterDisconteText.innerHTML = `$${totalAfterDisconte.toFixed(2)}`;

        localStorage.amountForPay = totalAfterDisconte.toFixed(2); // هذا سيقوم بتحديث المخزن المحلي
    }
}

// دالة لحساب مبلغ الخصم (إذا كان موجودًا)
function calculateDiscountAmount() {
    // من الممكن أن تكون هناك عملية حسابية للخصم هنا
    return 0; // كمثال، هنا نفترض عدم وجود خصم
}

// استدعاء الدالة لتحديث الإجمالي
updateCartTotal();


function deleteItem1(productId) {
  let storedCartItems = JSON.parse(localStorage.getItem("cartItems"));

  const updatedCartItems = storedCartItems.filter(
    (item) => item.product_id != productId.toString()
  );

  localStorage.setItem("cartItems", JSON.stringify(updatedCartItems));

  const itemRow = document.getElementById(`item-row-${productId}`);
  if (itemRow) {
    itemRow.remove(); // Remove the item row without reloading the page
  }

  updateTotalCartPrice(); // Update the total price without reloading the page
}

async function deleteItem(cartItemId) {
  let url = `https://localhost:44332/api/Cart/deleteItemById/${cartItemId}`;

  fetch(url, {
    method: "DELETE",
  }).then((response) => {
    if (response.ok) {
      const itemRow = document.getElementById(`item-row-${cartItemId}`);
      if (itemRow) {
        itemRow.remove(); // Remove the item row without reloading the page
      }
      alert("Item was deleted!");
      updateTotalCartPrice(); // Update the total price without reloading the page
    }
  });
}

async function changeQuantity(cartItemId, productPrice) {
  const quantity = document.getElementById(`quantity-${cartItemId}`);
  const newQuantity = parseInt(quantity.value);

  const url = `https://localhost:44332/api/Cart/changeQuantity`;

  const response = await fetch(url, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify({
      cartItemId: cartItemId,
      quantity: newQuantity,
    }),
  });

  const newTotalPrice = productPrice * newQuantity;

  const oldTotalPriceElement = document.getElementById(`total-price-${cartItemId}`);
  oldTotalPriceElement.innerHTML = `$${newTotalPrice.toFixed(2)}`;

  updateTotalCartPrice(); // Update the total price without reloading the page
}

async function checkOut() {
  debugger
    localStorage.checkOut = true;
    const userId = localStorage.getItem("UserId");

    if (userId && userId !== "null" && userId !== "") { 
        const url = `https://localhost:44332/api/Cart/ClearCart/${userId}`;

        try {
            const response = await fetch(url, {
                method: "DELETE",
            });

            if (response.ok) {
                const result = await response.json();
                localStorage.setItem("cartItems", JSON.stringify(result.cartItems)); // تخزين بيانات العناصر في الـ localStorage
                setTimeout(() => {
                    window.location.href = "/CheckOutrawa.html"; // تحويل إلى صفحة الجيك أوت
                }, 100); // تأخير 100 مللي ثانية
            } else {
                alert("حدث خطأ أثناء إفراغ السلة من الـ API.");
            }
        } catch (error) {
            console.error("خطأ أثناء إفراغ السلة:", error);
            alert("حدث خطأ أثناء إفراغ السلة.");
        }
    } else {
        alert("يجب عليك تسجيل الدخول لإستكمال عملية الشراء");
        setTimeout(() => {
            window.location.href = "/capitalshop/login.html"; // تحويل إلى صفحة تسجيل الدخول
        }, 100); // تأخير 100 مللي ثانية
    }
}


</script>
</body>

<!-- Mirrored from preview.colorlib.com/theme/capitalshop/cart.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 16 Sep 2024 04:32:23 GMT -->
</html>